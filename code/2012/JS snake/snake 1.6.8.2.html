<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head><title>snake</title>
<style type="text/css">
div#out{
	width:900px;
	min-height:600px;
	border:1px solid #09f;
	margin:0 auto;
}
div#content{
	width:440px;
	border:1px solid #09f;
	margin:10px;
	padding:10px 0;
	float:left;
}

div.divTagOut{
	width:400px;
	height:500px;
	/*height:420px;*/
	border:1px solid red;
	margin:10px;
	position:relative;
	float:left;
}
div.divTagOut div.divTag{
	float:left;
	border-right:1px solid red;
	border-bottom:1px solid red;
}
div.divTagOut div.divTag div.divTagTitle{
	padding:5px;
	cursor:pointer;
}
div.divTagOut div.divTag div.divTagContent{
	position:absolute;
	left:0px;
	right:0px;
	padding:5px;
	display:none;
	width:390px;
	/*height:380px;
	overflow:auto;*/
}
div.divTagOut div.defalutDivTag{ border-bottom:none; }
/*div.divTagOut div.defalutDivTag div.divTagTitle{ color:red; }*/
div.divTagOut div.defalutDivTag div.divTagContent{ display:block; }

.clear{
	clear:both;
}

div#showData{
	border:1px dashed #09f;
	margin:10px;
	padding:5px;
	line-height:30px;
}

table#mouseControl{ margin:100px 0px 0px 10px; }
table#mouseControl td{ text-align:center; }
table#mouseControl td input{ width:60px; height:40px; }

fieldset{
	margin-bottom:10px;
	padding:5px 12px 10px;
}

div#previewBody{
	width:40px;
	height:20px;
	display:inline-block;
	background:yellow;
	vertical-align:middle;
}
div#previewHead, div#previewFood{
	width:20px;
	height:20px;
	display:inline-block;
	vertical-align:middle;
}
div#previewHead{ background:red; }
div#previewFood{ background:#09f; }

p{ text-indent:30px; }
</style>
</head>
<script type="text/javascript">
/*-------------------------------------------
写在前面的话：

为提高文字录入速度，以下将“贪食蛇”简称为“蛇”
-------------------------------------------*/

var cell_px = 20;				//	单元格边长
var tdCols = tdRows = 20;		//	默认列数和行数
//var tMap = new Array(tdRows);	//	映射表格 与 “蛇”的范围信息（ tMap 是一个二维数组）
var tMap = null;				//	映射表格 与 “蛇”的范围信息（ tMap 是一个二维数组）
var s;							//	Snake Object
var sTowards = 2;				//	“蛇”的朝向：1上、2右、3下、4左（默认向右）
var sPassSelf = "false";		//	是否允许“蛇”穿过自身（默认为否）
var sInitLength = 3;			//	“蛇”的初始长度（含头部）
var timeout = 300;				//	默认停顿时间 300 毫秒
var circleID = null;

//	WASD和方向键对应的键盘码
var WASD = {
	W : 87, A : 65, S : 83, D : 68,
	w : 119, a : 97, s : 115, d : 100,
	UP : 38, LEFT : 37, DOWN : 40, RIGHT : 39
};
//	色彩控制常量
var SCOLOR = {
	HEAD : "red", BODY : "yellow", FOOD : "#09f",
	
	//	默认颜色，供 恢复默认时使用
	DEFAULT_HEAD : "red", DEFAULT_BODY : "yellow", DEFAULT_FOOD : "#09f"
};

/*--------------------- 已过时 ---------------------
//	初始化映射（这里使用 htmlDOM 标准方法，也可以采用 tableDOM 专属方法处理）
function reflectMap(){
	var table = document.getElementById("tMap");
	
	var trs = getFirstChildNode(table).childNodes;
	
	var row=0, col=0;		//	tMap[row][col]
	for(i in trs){
		if(trs[i].nodeType == 1){
			var tds = trs[i].childNodes;
			
			tMap[row] = new Array(tdCols);
			for(j in tds){
				if(tds[j].nodeType == 1){
					tMap[row][col++] = tds[j];
				}
			}
			
			row++;
			col = 0;
		}
	}
}
//	辅助方法，获取第一个子元素。主要用于表格
function getFirstChildNode(parent){			//	重命名为 getFirstChildElement 更好
	var child = parent.firstChild;
	
	while(child && child.nodeType != 1){
		child = child.nextSibling;
	}
	
	return child;
}
-----------------------------------------------*/
//	初始化映射（使用 tableDOM 专属方法处理）
function reflectMap(y, x){
	var table = document.getElementById("tMap");

	tMap = new Array(y);
	for(var row=0, tr; row<y; row++){
		tr = table.insertRow(row);
		//tr = table.insertRow(0);	//	往前插入表格行，会使tMap布局颠倒（包括tr.insertCell(0)）
		tMap[row] = new Array(x);
		for(var col=0; col<x; col++){
			tMap[row][col] = tr.insertCell(col);
			//tMap[row][col] = tr.insertCell(0);
		}
	}
}

//	游戏初始化
function init(){
	reflectMap(tdRows, tdCols);
	newDefaultSnake();
	repaint();
}
//	按当前配置重新初始化“蛇”
function newDefaultSnake(){
	s = new Snake({
		maxCol : tdCols,
		maxRow : tdRows,
		//maxLength : ,
		towards : sTowards,
		passSelf : sPassSelf,
		initLength : sInitLength
	});
}

//	循环（定时移动）
function circle(){
	//	以 timeout 毫秒为间隔，反复调用 snakeMove()
	circleID = setInterval("snakeMove()", timeout);
	document.getElementById("gameState_span").innerHTML = "游戏中";
	document.getElementById("gameState_button").value = "暂停";
}
//	取消（定时移动）
function unCircle(){
	clearInterval(circleID);
	circleID = null;
	document.getElementById("gameState_span").innerHTML = "暂停中";
	document.getElementById("gameState_button").value = "继续";
}

//	重画，即刷新视觉效果（作用：①“蛇”移动之后，重画可覆盖之前的图案；②当改变颜色配置时，利用这个可以即时看到效果）
function repaint(){
	for(var i=1; i<s.length(); i++){
		tMap[s.body[i].y][s.body[i].x].style.backgroundColor = SCOLOR.BODY;
	}
	
	tMap[s.head.y][s.head.x].style.backgroundColor = SCOLOR.HEAD;	//	if the snake can pass itself, that its head can cover its body
	
	tMap[s.food.y][s.food.x].style.backgroundColor = SCOLOR.FOOD;
}

//	让“蛇”移动
function snakeMove(){
	if(s.move()){	//	如果能继续移动，则移动。否则出 Game over! 提示（但还是可以继续的，具体方法参考 帮助说明）
		if(s.head.y == s.food.y && s.head.x == s.food.x){
			s.add(s.last.y, s.last.x);
			s.newFood();
		}else{
			tMap[s.last.y][s.last.x].style.backgroundColor = "";
		}
		
		repaint();
	}else{
		unCircle();
		alert("Game over!");
	}
}

//	点：坐标对象模型，辅助建模
var Point = function (y, x){
	this.x = x;
	this.y = y;
}
//	“蛇”模型，内置：增加、减少“蛇身”长度、“蛇”移动、生成“新食物”坐标等方法
var Snake = function(snakeInitData){
	//	“蛇”运动方向 常量
	Snake.side = {
		UP :	1,
		RIGHT :	2,
		DOWN :	3,
		LEFT :	4
	};
	this.towards = (snakeInitData.towards>=1 && snakeInitData.towards<=4) ? Math.floor(snakeInitData.towards) : Snake.side.RIGHT;
	this.back = (this.towards>2) ? this.towards-2 : this.towards+2;
	
	this.maxCol = (snakeInitData.maxCol>=2) ? Math.floor(snakeInitData.maxCol) : 10;		//	0-9
	this.maxRow = (snakeInitData.maxRow>=2) ? Math.floor(snakeInitData.maxRow) : 10;		//	0-9
	
	this.body = new Array();		//	var body = new Array();
	
	this.add = function (y, x){		//	var add ------- in release
		if(this.body.length >= this.maxLength-1){	//	if(this.body.length >= this.maxLength-2)
			return;
		}
		
		this.body.push(new Point(y, x));
		//	在snake2.html中，蛇身各节点x、y均相同，是因为它们引用了同一对象point。这导致一个point的改变，全部节点都受影响！
		//this.body[this.body.length-1];	//	对象创建过程中，并没有直接使用x、y的值。直至对象初次使用时，才赋予x、y值（此时均为0）。
	}
	this.remove = function (){
		if(this.body.length > initLength){
			this.last = this.body.pop();
		}
	}
	
	//var initLength = (snakeInitData.length==null || isNaN(snakeInitData.length) || snakeInitData.length<1) ? 1 : snakeInitData.length;
	var initLength = (snakeInitData.initLength>1) ? Math.round(snakeInitData.initLength) : 1;	//	Math.floor
/*
	if((this.towards == Snake.side.RIGHT || this.towards == Snake.side.LEFT) && initLength>this.maxCol){	//	Cannot read property 'RIGHT' of undefined
		initLength = this.maxCol;
	}else if((this.towards == Snake.side.DOWN || this.towards == Snake.side.UP) && initLength>this.maxRow){
		initLength = this.maxRow;
	}
*/
	if(!(this.towards&1) && initLength>this.maxCol){	//	if((this.towards == Snake.side.RIGHT || this.towards == Snake.side.LEFT) && initLength>this.maxCol)
		initLength = this.maxCol;
	}else if((this.towards&1) && initLength>this.maxRow){
		initLength = this.maxRow;
	}
	
	var initBodyX, initBodyY;
	if(this.towards == Snake.side.UP){
		initBodyY = "this.maxRow-initLength+i";
		initBodyX = "this.maxCol-1";
	}else if(this.towards == Snake.side.RIGHT){
		initBodyY = "0";
		initBodyX = "initLength-1-i";
	}else if(this.towards == Snake.side.DOWN){
		initBodyY = "initLength-1-i";
		initBodyX = "0";
	}else if(this.towards == Snake.side.LEFT){
		initBodyY = "this.maxRow-1";
		initBodyX = "this.maxCol-initLength+i";
	}
	for(var i=0; i<initLength; i++){
		//this.add(0, initLength-1-i);
		eval("this.add(" + initBodyY + ", " + initBodyX + ");");	//if(this.towards == 1)this.add(this.maxRow-initLength+i, this.maxCol);
	}
	this.maxLength = (snakeInitData.maxLength>initLength && snakeInitData.maxLength<this.maxCol*this.maxRow) ? snakeInitData.maxLength : this.maxCol*this.maxRow;
	
	this.head = this.body[0];
	this.tail = function (){
		return this.body[this.body.length-1];
	};
	this.last = this.body[this.body.length-1];		//	last time tail
	
	this.length = function (){
		return this.body.length;
	}
	
	
	this.passSelf = snakeInitData.passSelf;
	this.isInBody = function (y, x){
		if(this.passSelf == "true"){
			return false;
		}
	
		for(var i=0; i<this.body.length-1; i++){		//	for(i in this.body) 时，蛇头的下一个位置不可以是原蛇尾的位置
			if(y == this.body[i].y && x == this.body[i].x){
				return true;
			}
		}
		return false;
	}
	
	this.move = function (){
		var x = this.body[0].x;
		var y = this.body[0].y;
		
		if(this.towards == Snake.side.UP){
			if(y == 0 || this.isInBody(y-1, x)){		//	若 this.isInBody 定义为 var isInBody，则isInBody函数不会返回 true
				return false;
			}
		
			this.body.unshift(new Point(y-1, x));
			
		}else if(this.towards == Snake.side.RIGHT){
			if(x == this.maxCol-1 || this.isInBody(y, x+1)){
				return false;
			}
		
			this.body.unshift(new Point(y, x+1));
			
		}else if(this.towards == Snake.side.DOWN){
			if(y == this.maxRow-1 || this.isInBody(y+1, x)){
				return false;
			}
		
			this.body.unshift(new Point(y+1, x));
			
		}else if(this.towards == Snake.side.LEFT){
			if(x == 0 || this.isInBody(y, x-1)){
				return false;
			}
		
			this.body.unshift(new Point(y, x-1));
		}
		
		this.head = this.body[0];
		this.last = this.body.pop();
		this.back = (this.towards>2) ? this.towards-2 : this.towards+2;
		return true;
	}
	
	// validata food not in body
	this.food = new Point(Math.floor(Math.random()*this.maxRow), Math.floor(Math.random()*this.maxCol));
	while( this.isInBody(this.food.y, this.food.x) ){
		this.food.x =  Math.floor(Math.random()*this.maxCol);
		this.food.y =  Math.floor(Math.random()*this.maxRow);
	}
	
	this.newFood = function (){
		var x =  Math.floor(Math.random()*this.maxCol);
		var y =  Math.floor(Math.random()*this.maxRow);
		
		while( this.isInBody(y, x) ){
			x =  Math.floor(Math.random()*this.maxCol);
			y =  Math.floor(Math.random()*this.maxRow);
		}
		
		this.food.x = x;
		this.food.y = y;
	}
}

//	键盘控制，获取键盘码
function kbControl(evt){
	var e = window.event || evt;
	
	//alert(e.keyCode || e.which);
	var keyNum = e.keyCode || e.which;

	return control(keyNum);
}
//	响应键盘码操作，包括：“蛇”的移动 或 暂停、开始
function control(keyNum){
	
	if(circleID == null){
		if(keyNum == 32){
			circle();
		}
		return false;
	}
	
	if(keyNum == WASD.W || keyNum == WASD.UP){
		if(s.back != Snake.side.UP){
			s.towards = Snake.side.UP;
		}
		if(s.back == Snake.side.DOWN){	//	加速
			snakeMove();
		}
		
	}else if(keyNum == WASD.A || keyNum == WASD.LEFT){
		if(s.back != Snake.side.LEFT){
			s.towards = Snake.side.LEFT;
		}
		if(s.back == Snake.side.RIGHT){
			snakeMove();
		}
		
	}else if(keyNum == WASD.S || keyNum == WASD.DOWN){
		if(s.back != Snake.side.DOWN){
			s.towards = Snake.side.DOWN;
		}
		if(s.back == Snake.side.UP){
			snakeMove();
		}
		
	}else if(keyNum == WASD.D || keyNum == WASD.RIGHT){
		if(s.back != Snake.side.RIGHT){
			s.towards = Snake.side.RIGHT;
		}
		if(s.back == Snake.side.LEFT){
			snakeMove();
		}
		
	}else if(keyNum == 32){
		unCircle();
	}
	
	return false;
}
</script>
<!-- onkeydown使用虚拟键盘码，不区分字母大小写（默认为大写字母键值）；而onkeypress会使用键盘生成的 Unicode 字符码，区分字母大小写 -->
<!-- onkeydown 加入return是为了阻止 按空格键事件 起泡（当页面有滚动条时，按空格键浏览器会翻页） -->
<body onload="init()" onkeydown="return kbControl(event)">
<div id="out">
	<div id="content">
	
<script type="text/javascript">
//	输出表格
//document.write("<table id='tMap' width='400' height='400' cellspacing='0' align='center' style='border:1px solid black;'>");
document.write("<table id='tMap' width='" + tdCols*cell_px + "' height='" + tdRows*cell_px + "' cellspacing='0' align='center' style='border:1px solid black;'>");
/*
for(var i=0; i<tdRows; i++){
	document.write("<tr>");
	for(var j=0; j<tdCols; j++){
		document.write("<td></td>");
	}
	document.write("</tr>");
}
*/
document.write("</table>");
</script>

	</div>
	
	<div class="divTagOut">
		<div class="divTag defalutDivTag">
			<div class="divTagTitle" onmouseover="showDivTagContent(this)">帮助说明</div>
			<div class="divTagContent">
				如何开始游戏：<br />①按空格键；<br />②在下方的游戏状态处点击“切换”；<br />③切换至右边的“鼠标控制”选项卡，点击“开始”。
				<p>游戏控制：使用“W”、“A”、“S”、“D”或方向键控制“蛇”的运动方向。</p>
				<p>游戏开始后，如需暂停，可按空格键，或在下方的游戏状态处点击“切换”，或在“鼠标控制”选项卡中，点击“暂停”。</p>
				<p>选项卡“控制面板”中，可设定游戏数据。</p>
				<p>选项卡“鼠标控制”的操作：将鼠标滑过 标有方向 的按钮，即可控制“蛇”的相应移动。（中间的 暂停/继续 按钮，则需点击才响应）</p>
				<p>当游戏因玩家失误而提示“Game over!”时，可以继续按空格键（或上诉开始游戏的其它方式）继续（因为本游戏没有强制结束并重新开始）。
					但此时，需要迅速改变“蛇”的运动方向，否则会因无法继续移动而再次提示“Game over!”！</p>
			</div>
		</div>
		<div class="divTag">
			<div class="divTagTitle" onmouseover="showDivTagContent(this)">控制面板</div>
			<div class="divTagContent"><form name="setForm" onreset="resetPreviewColor()">
				<fieldset>
					<legend>速度控制</legend>
					<div class="setItemDiv">
						停顿时间:
						<select name="setTime">
							<option value="100">100</option>
							<option value="300" selected="selected">300(默认)</option>
							<option value="500">500</option>
							<option value="1000">1000</option>
						</select>
						毫秒
						<input type="button" value="自定义" title="自定义功能暂未上线，敬请期待" />
					</div>
				</fieldset>
					
				<fieldset>
					<legend>外观控制</legend>
					<div class="setItemDiv">
						“头部”颜色:
						<select name="setHeadColor" onchange="document.getElementById('previewHead').style.backgroundColor=this.value">
							<option value="red" selected="selected">red(默认)</option>
							<option value="yellow">yellow</option>
							<option value="aqua">aqua</option>
							<option value="black">black</option>
							<option value="blue">blue</option>
							<option value="fuchsia">fuchsia</option>
							<option value="gray">gray</option>
							<option value="green">green</option>
							<option value="lime">lime</option>
							<option value="maroon">maroon</option>
							<option value="navy">navy</option>
							<option value="olive">olive</option>
							<option value="purple">purple</option>
							<option value="silver">silver</option>
							<option value="teal">teal</option>
						</select>
						<input type="button" value="自定义" title="自定义功能暂未上线，敬请期待" />
					</div>
					<div class="setItemDiv">
						“身体”颜色:
						<select name="setBodyColor" onchange="document.getElementById('previewBody').style.backgroundColor=this.value">
							<option value="yellow" selected="selected">yellow(默认)</option>
							<option value="red">red</option>
							<option value="aqua">aqua</option>
							<option value="black">black</option>
							<option value="blue">blue</option>
							<option value="fuchsia">fuchsia</option>
							<option value="gray">gray</option>
							<option value="green">green</option>
							<option value="lime">lime</option>
							<option value="maroon">maroon</option>
							<option value="navy">navy</option>
							<option value="olive">olive</option>
							<option value="purple">purple</option>
							<option value="silver">silver</option>
							<option value="teal">teal</option>
						</select>
						<input type="button" value="自定义" title="自定义功能暂未上线，敬请期待" />
					</div>
					<div class="setItemDiv">
						“食物”颜色:
						<select name="setFoodColor" onchange="document.getElementById('previewFood').style.backgroundColor=this.value">
							<option value="#0099ff" selected="selected">#0099ff(默认)</option>
							<option value="red">red</option>
							<option value="yellow">yellow</option>
							<option value="aqua">aqua</option>
							<option value="black">black</option>
							<option value="blue">blue</option>
							<option value="fuchsia">fuchsia</option>
							<option value="gray">gray</option>
							<option value="green">green</option>
							<option value="lime">lime</option>
							<option value="maroon">maroon</option>
							<option value="navy">navy</option>
							<option value="olive">olive</option>
							<option value="purple">purple</option>
							<option value="silver">silver</option>
							<option value="teal">teal</option>
						</select>
						<input type="button" value="自定义" title="自定义功能暂未上线，敬请期待" />
					</div>
					<div class="setItemDiv">
						<table border="0" cellspacing='0' cellpadding="0">
							<tr>
								<td>预览：</td>
								<td><div id="previewBody"></div></td>
								<td><div id="previewHead"></div></td>
								<td width="150" align="right">“食物”颜色：</td>
								<td><div id="previewFood"></div></td>
							</tr>
						</table>
					</div>
					<div class="setItemDiv">
					</div>
				</fieldset>
				
				<fieldset>
					<legend>活动范围</legend>
					<div class="setItemDiv">
						行数:
						<select name="setTdRows">
							<option value="20" selected="selected">20(默认)</option>
							<option value="15">15</option>
							<option value="10">10</option>
							<option value="5">5</option>
						</select>
						<input type="button" value="自定义" title="自定义功能暂未上线，敬请期待" />
					</div>
					<div class="setItemDiv">
						列数:
						<select name="setTdCols">
							<option value="20" selected="selected">20(默认)</option>
							<option value="15">15</option>
							<option value="10">10</option>
							<option value="5">5</option>
						</select>
						<input type="button" value="自定义" title="自定义功能暂未上线，敬请期待" />
					</div>
				</fieldset>
				
				<fieldset>
					<legend>“蛇”数据设定</legend>
					<div class="setItemDiv">
						初始长度（含头部）:
						<select name="setInitLength">
							<option value="3" selected="selected">3(默认)</option>
							<option value="5">5</option>
							<option value="7">7</option>
						</select>
						<input type="button" value="自定义" title="自定义功能暂未上线，敬请期待" />
					</div>
					<div class="setItemDiv">
						允许穿过身体:
						<label>
							不允许(默认)<input type="radio" value="false" name="setPassSelfRadio" onclick="document.setForm.setPassSelf.value=this.value" />
						</label>&nbsp;&nbsp;
						<label>
							允许<input type="radio" value="true" name="setPassSelfRadio" onclick="document.setForm.setPassSelf.value=this.value" />
						</label>
						<input type="hidden" name="setPassSelf" value="false" />
					</div>
					<div class="setItemDiv">
						蛇头朝向:
						<select name="setTowards">
							<option value="2" selected="selected">右(默认)</option>
							<option value="3">下</option>
							<option value="4">左</option>
							<option value="1">上</option>
						</select>
					</div>
				</fieldset>
				<!-- <a href="xxx.html?tdCols=xx.." target="_self" onclick="reset()">设置</a> -->
				<!-- 分数 -->
				<div>
					<input type="button" value="确定并重新开始" onclick="setData()" title="部分设置需重新开始才生效" />
					<input type="button" value="应用" onclick="apply()" title="速度、外观控制即时生效" />
					<input type="reset" value="重置" title="仅重置默认选项，需应用或确定后才设置才生效" />
				</div>
			</form></div>
		</div>
		<div class="divTag">
			<div class="divTagTitle" onmouseover="showDivTagContent(this)">鼠标控制</div>
			<div class="divTagContent">
				<table id="mouseControl" border="0" cellspacing='0' cellpadding="3">
					<tr>
						<td></td>
						<td><input type="button" value="↑" onmouseover="control(WASD.UP)" /></td>
						<td></td>
					</tr>
					<tr>
						<td><input type="button" value="←" onmouseover="control(WASD.LEFT)" /></td>
						<td><input type="button" value="开始" id="gameState_button" onclick="changeState()" /></td>
						<td><input type="button" value="→" onmouseover="control(WASD.RIGHT)" /></td>
					</tr>
					<tr>
						<td></td>
						<td><input type="button" value="↓" onmouseover="control(WASD.DOWN)" /></td>
						<td></td>
					</tr>
				</table>
			</div>
		</div>
		<div class="divTag">
			<div class="divTagTitle" onmouseover="showDivTagContent(this)">测试</div>
			<div class="divTagContent">
				<fieldset>
					<legend>模型控制</legend>
					<div class="setItemDiv">
						蛇身长度
						<input type="button" value="+" onclick="addSnakeLength(1)" />
						<input type="button" value="-" onclick="minusSnakeLength(1)" />
						<input type="button" value="自定义" title="自定义功能暂未上线，敬请期待" />
					</div>
				</fieldset>
			</div>
		</div>
		<div class="divTag">
			<div class="divTagTitle" onmouseover="showDivTagContent(this)">关于</div>
			<div class="divTagContent">
				<p>本游戏（version 6.8）由 <a href="mailto:x.l.st@qq.com">xlst</a>
					于2012年4月7日至2012年4月13日创作（版本还在升级中，后续功能更加精彩，敬请期待！）</p>
				<p>游戏的核心部分，运用了javascript的面向对象编程技巧，使该游戏的可扩展性大大加强。
					与此同时，配合MVC设计理念，增加了多种游戏数据设定，增强游戏体验。</p>
				<p>最后，欢迎您的宝贵建议和反馈，我将继续对其进行完善，谢谢！</p>
			</div>
		</div>
	</div>
	
	<div class="clear" id="showData">
		分数：<span></span><br />
		时间：<span></span><br />
		状态：<span id="gameState_span">未开始</span><input type="button" value="切换" onclick="changeState()" />
	</div>
	
	<div>
		<input type="button" value="重玩" onclick="reBegin()" title="保持当前的游戏设定，本局重新开始" />
		<input type="button" value="全部恢复默认" onclick="document.location.reload()" />
		<!-- <input type="button" value="开始" onclick="" /> -->
	</div>
</div>
<script type="text/javascript">
/*-------------------------------------------
下面的 javascript 代码不属于游戏的核心代码。
因此，在设计、健壮性等方面没有进行优化，仅保证功能的实现
-------------------------------------------*/

//	显示某 Tag 标签里的内容（为了简便，这两个方法没有加强容错性）
function showDivTagContent(divTagTitle){
	var divTagContent = divTagTitle.nextSibling;
	
	while(divTagContent.nodeType != 1){
		divTagContent = divTagContent.nextSibling;		//	if(null || undefined)return;
	}
	
	hideDivTagExcept(divTagTitle.parentNode);
	
	divTagContent.style.display = "block";
}

//	隐藏所有 Tag 标签里的内容除了 参数Tag
function hideDivTagExcept(divTag){
	var divTags = divTag.parentNode.childNodes;
	
	for(i in divTags){
		if(divTags[i].nodeType == 1 && divTags[i].nodeName == "DIV"){
			divTags[i].style.cssText = "border-bottom:1px solid red;";
		
			//divTags[i].getElementsByTagName("div")[0].style.color = "";
			divTags[i].getElementsByTagName("div")[1].style.display = "none";
		/*
			var div = divTags[i].getElementsByTagName("div");
			for(j in div){
				if(div[j].className == "divTagContent"){
					div[j].style.display = "none";
					//alert(div[j].style.cssText);
				}
			}
		*/
			
			if(divTags[i] == divTag){
				divTags[i].style.cssText = "border-bottom:0px solid red;";
				//divTags[i].getElementsByTagName("div")[0].style.color = "red";
			}
		}
	}
}

//	重玩（本局重新开始，并保持当前设置）
function reBegin(){
	unCircle();
	newDefaultSnake();
	resetView();
	repaint();
}
//	清除上局游戏画面
function resetView(){
	for(var i=0; i<tdRows; i++){
		for(var j=0; j<tdCols; j++){
			tMap[i][j].style.backgroundColor = "";
		}
	}
	
	document.getElementById("gameState_span").innerHTML = "未开始";
	document.getElementById("gameState_button").value = "开始";
}

//	切换游戏状态（继续/暂停）
function changeState(){
	if(circleID == null){
		circle();
	}else{
		unCircle();
	}
}

//	设置。会使游戏重新开始（因为有的设置需重新开始才生效）
function setData(){
	unCircle();
	applyInstantData();
/*
	tdRows = document.setForm.setTdRows.value;
	tdCols = document.setForm.setTdCols.value;
	var table = document.getElementById("tMap");
	var tableInnerHTML = "";
	var row=0, col=0;
	for(row=0; row<tdRows; row++){
		tableInnerHTML += "<tr>";
		for(col=0; col<tdCols; col++){
			tableInnerHTML +="<td></td>";
		}
		tableInnerHTML += "</tr>";
	}
	//	下面两句在谷歌和火狐中可以被支持，在IE中不被支持
	//table.innerHTML = tableInnerHTML;
	//getFirstChildNode(table).innerHTML = tableInnerHTML;
	
	//table.width = tdCols*cell_px;		//	有效
	//table.height = tdRows*cell_px;	//	无效
	
	tMap.length = 0;
	reflectMap();
*/
	tMap.length = 0;
	var table = document.getElementById("tMap");
	//	delete table:rows
	for(var i=0; i<tdRows; i++){
		table.deleteRow(0);
	}
	
	tdRows = document.setForm.setTdRows.value;
	tdCols = document.setForm.setTdCols.value;
	
/*	//	reflect table map : tMap
	tMap = new Array(tdRows);
	for(var row=0, tr; row<tdRows; row++){
		tr = table.insertRow(row);
		//tr = table.insertRow(0);	//	往前插入表格行，会使tMap布局颠倒（包括tr.insertCell(0)）
		tMap[row] = new Array(tdCols);
		for(var col=0; col<tdCols; col++){
			tMap[row][col] = tr.insertCell(col);
			//tMap[row][col] = tr.insertCell(0);
		}
	}
*/
	reflectMap(tdRows, tdCols);

	//	resize table : width&height
	table.style.width = tdCols*cell_px + "px";
	table.style.height = tdRows*cell_px + "px";
	
	sTowards = document.setForm.setTowards.value;
	sPassSelf = document.setForm.setPassSelf.value;
	sInitLength = document.setForm.setInitLength.value;
	s = new Snake({
		maxCol : tdCols,
		maxRow : tdRows,
		//maxLength : ,
		towards : sTowards,
		passSelf : sPassSelf,
		initLength : sInitLength
	});
	
	resetView();
	repaint();
}
//	应用。在当前游戏下，使部分设置即时生效
function apply(){
	applyInstantData();
	repaint();
}
//	应用即时生效的数据
function applyInstantData(){
	timeout = document.setForm.setTime.value;
	
	SCOLOR.HEAD = document.setForm.setHeadColor.value;
	SCOLOR.BODY = document.setForm.setBodyColor.value;
	SCOLOR.FOOD = document.setForm.setFoodColor.value;

	s.passSelf = document.setForm.setPassSelf.value;
}

//	重置预览视觉效果
function resetPreviewColor(){
	document.getElementById('previewHead').style.cssText = "";
	document.getElementById('previewBody').style.cssText = "";
	document.getElementById('previewFood').style.cssText = "";
}

function addSnakeLength(addNum){
	for(var i=0; i<addNum; i++){
		s.add(s.tail().y, s.tail().x);
	}
}
function minusSnakeLength(minusNum){
	for(var i=0; i<minusNum; i++){
		s.remove();
		tMap[s.last.y][s.last.x].style.backgroundColor = "";
	}
}
</script>
</body>
</html>